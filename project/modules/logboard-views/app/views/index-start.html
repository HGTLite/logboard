<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="logboard 日志应用系统">
    <meta name="keywords" content="logs, big data">
    <meta name="author" content="yaoooo and Bootstrap contributors">
    <title>logboard 日志应用系统</title>
    <link rel="stylesheet" href="../res/styles/css/bootstrap-3.3.7.css"/>
    <link rel="stylesheet" href="../res/styles/css/leaflet-1.0.0rc3.css"/>
    <link href='https://api.tiles.mapbox.com/mapbox.js/v1.6.4/mapbox.css' rel='stylesheet'/>
    <link rel="stylesheet" href="../res/fonts/css/font-awesome.css">
    <link rel="stylesheet" href="../res/styles/general.css"/>
    <link rel="stylesheet" href="../res/styles/layout.css"/>
    <link rel="stylesheet" href="../res/styles/bscard.css"/>
    <link rel="stylesheet" href="../res/styles/ipviews.css"/>
    <link rel="stylesheet" href="../res/styles/colors.css"/>
    <link rel="stylesheet" href="../res/styles/svg.css"/>
</head>

<body>

<!-- Fixed navbar 顶部导航栏-->
<nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">LogBoard 日志公告牌</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <li class="active"><a href="#aLogsOverview">日志概览</a></li>
                <li><a href="#aLogsException">异常监控</a></li>
                <li><a href="#aLogsStats">日志统计</a></li>
                <li><a href="#aLogsBehavior">日志挖掘</a></li>
                <li><a href="#about">关于</a></li>
            </ul>
        </div><!--/.nav-collapse -->
    </div>
</nav>
<!-- /Fixed navbar 顶部导航栏-->

<!--顶部导航栏高度站位符-->
<div class="blank_divider48"></div>
<!--/顶部导航栏高度站位符-->

<!--首屏简介模块-->
<div id="logsTop" class="container-fluid screen-page ">
    <!--3大快速入口-->
    <div class="row _text_align_center blank_divider400 bg_blue_svg ">
        <div class="col-sm-4 " onclick="window.open('logs-search.html')">
            <div style="margin-top: 25%">
                <img class="top-icon" src="../images/top-search.svg" alt="日志搜索">
                <div class="row blank_divider30 "></div>
                <button class="btn c_fff  bg_transparent _white_border _width40 letter_spacing4">日志搜索</button>
            </div>
        </div>
        <div class="col-sm-4 " onclick="window.open('logs-stats.html')">
            <div style="margin-top: 25%">
                <img class="top-icon" src="../images/top-monitor.svg" alt="日志监控">
                <div class="row blank_divider30 "></div>
                <button class="btn c_fff  bg_transparent _white_border _width40 letter_spacing4">日志监控</button>
            </div>
        </div>
        <div class="col-sm-4 " onclick="window.open('logs-stats.html')">
            <div style="margin-top: 25%">
                <img class="top-icon" src="../images/top-stats.svg" alt="日志统计">
                <div class="row blank_divider30 "></div>
                <button class="btn c_fff  bg_transparent _white_border _width40 letter_spacing4">日志统计</button>
            </div>
        </div>
    </div>

    <!--简单数量统计-->
    <div id="apps_general1" class="row _divider_stripe bg_gray_shallow">
        <div class="col-sm-4 ">
            <div style="margin-top: 18%">
                <i class="fa fa-cubes fa-2x"></i>
                <div class="stats_count_number">12</div>
                <div class="stats_count_desc">接入应用数</div>
            </div>
        </div>

        <div class="col-sm-4 ">
            <div style="margin-top: 18%">
                <i class="fa fa-th fa-2x"></i>
                <div class="stats_count_number">12306</div>
                <div class="stats_count_desc">日志记录数</div>
            </div>
        </div>
        <div class="col-sm-4 ">
            <div style="margin-top: 18%">
                <i class="fa fa-clock-o fa-2x"></i>
                <div class="stats_count_number">488 小时</div>
                <div class="stats_count_desc">监控总时间</div>
            </div>
        </div>
    </div>
    <div class="blank_divider10 ">
        <a name="aLogsOverview"></a>
    </div>
</div>
<!--/首屏简介模块-->

<!--系统概览模块-->

<div id="logsOverview" class="container-fluid screen-page  ">
    <div class="row  _height100 _text_align_center margin-top3 ">
        <!--日志饼状图-->
        <div class="col-sm-3 ">
            <div class="row">
                <svg id="svgExpStatsPie" width="200" height="200"></svg>
            </div>
            <div class="blank_divider100"></div>
            <div class="row">
                <svg id="svgExpStatsLegend" width="210" height="200"></svg>
            </div>
        </div>
        <!--日志曲线图-->
        <div class="col-sm-9">
            <div id="logsCurveHeader" class="row bg_white_pure ">
                <div class="col-sm-3 _text_align_center">
                </div>
                <div class="col-sm-4 _text_align_center">
                    <span class="h4">日志实时处理量变化曲线</span>
                </div>
                <div class="col-sm-5 _text_align_right">
                    <span class="align_right ">
                    <a id="a1" href="javascript:void(0)" class="btn btn-info _width15">1小时</a>
                    <a id="a2" href="javascript:void(0)" class="btn text-muted _width15">24小时</a>
                    <a id="a3" href="javascript:void(0)" class="btn text-muted _width15">昨天</a>
                    <a id="a4" href="javascript:void(0)" class="btn text-muted _width15">7天</a>
                    <a id="a5" href="javascript:void(0)" class="btn text-muted _width15">本月</a>
                    </span>
                </div>
            </div>
            <div class="blank_divider20"></div>
            <div id="logsGeneralCurve" class="row bg_white_pure">
                <div class="col-sm-12 _text_align_center">
                    <svg id="svgLogsGenaral" width="960" height="400"></svg>
                </div>
            </div>
        </div>
    </div>

</div>
<!--/系统概览模块-->


<!--异常监控模块-->
<div id="logsException" class="container-fluid screen-page bg_gray_shallow ">
    <div class="row  blank_divider20 ">
        <a name="aLogsException"></a>
    </div>
    <!--<a name="aLogsException"></a>-->
    <div class="row blank_divider30"></div>
    <!--曲线图标题部分-->
    <div id="expLogsHeader" class="row blank_divider40 ">
        <div class="col-sm-3 _text_align_center">
        </div>
        <div class="col-sm-4 _text_align_center">
            <span class="h3">异常日志监控</span>
        </div>
        <div class="col-sm-5 _text_align_center">
    <span class="align_right ">
    <a id="a01" href="javascript:void(0)" class="btn btn-info">近1小时</a>
    <a id="a02" href="javascript:void(0)" class="btn text-muted ">24小时</a>
    <a id="a03" href="javascript:void(0)" class="btn text-muted">昨天</a>
    <a id="a04" href="javascript:void(0)" class="btn text-muted">7天</a>
    <a id="a05" href="javascript:void(0)" class="btn text-muted">本月</a>
    </span>
        </div>
    </div>
    <!--异常曲线-->
    <div id="expLogsCurve" class="row ">
        <div class="col-sm-12 _text_align_center">
            <svg id="svgLogsExp" width="1080" height="330"></svg>
        </div>
    </div>

    <!--异常消息列表-->
    <div id="expDetails" class=" row ">

        <div class="col-sm-1  _text_align_center _to_top30 ">
            <i class="fa  fa-angle-left fa-4x  c_bdbdbd"></i>
        </div>

        <div class="col-sm-10  ">

            <div class="row ">

                <div class="col-sm-4 ">
                    <div id="expCard01" class="card exp_card _width80 ">
                        <!--<img class="card-i2mg-top" src="..." alt="Card image cap">-->
                        <div class="card-block exp_item_padding ">
                            <h4 class="card-title exp_card_title_size">app1二维地图</h4>
                            <p class="card-text exp_card_text_size">Utils: Uncaught exception in thread SparkListenerBus
                                java.lang.InterruptedException at java.util.concurrent.locks...
                            </p>
                        </div>
                        <ul class="list-group list-group-flush exp_card_item_size ">
                            <li class="list-group-item exp_item_padding">2016-11-08 23:32:06</li>
                            <li class="list-group-item exp_item_padding">com.hgt.App 163</li>
                        </ul>
                        <div class="card-block exp_contents_padding ">
                            <div class="_float_left">
                                <a href="#" class="card-link exp_card_text_size">查看详情</a>

                            </div>
                            <div class="_float_right">
                                <span class="label label-danger label-pill float-xs-right exp_card_item_size">严重</span>
                            </div>

                            <!--<span class="_text_align_right ">严重</span>-->
                        </div>
                    </div>
                </div>


                <div class="col-sm-4 ">
                    <div id="expCard02" class="card exp_card _width80 ">
                        <!--<img class="card-i2mg-top" src="..." alt="Card image cap">-->
                        <div class="card-block exp_item_padding ">
                            <h4 class="card-title exp_card_title_size">app2二维地图</h4>
                            <p class="card-text exp_card_text_size">Utils: Uncaught exception in thread SparkListenerBus
                                java.lang.InterruptedException at java.util.concurrent.locks...
                            </p>
                        </div>
                        <ul class="list-group list-group-flush exp_card_item_size ">
                            <li class="list-group-item exp_item_padding">2016-11-08 23:32:06</li>
                            <li class="list-group-item exp_item_padding">com.hgt.App 163</li>
                        </ul>
                        <div class="card-block exp_contents_padding ">
                            <div class="_float_left">
                                <a href="#" class="card-link exp_card_text_size">查看详情</a>

                            </div>
                            <div class="_float_right">
                                <span class="label label-warning label-pill float-xs-right exp_card_item_size">警告</span>

                            </div>

                            <!--<span class="_text_align_right ">严重</span>-->
                        </div>
                    </div>
                </div>


                <div class="col-sm-4 ">
                    <div id="expCard03" class="card exp_card  _width80 ">
                        <!--<img class="card-i2mg-top" src="..." alt="Card image cap">-->
                        <div class="card-block exp_item_padding ">
                            <h4 class="card-title exp_card_title_size">app3二维地图</h4>
                            <p class="card-text exp_card_text_size">Utils: Uncaught exception in thread SparkListenerBus
                                java.lang.InterruptedException at java.util.concurrent.locks...
                            </p>
                        </div>
                        <ul class="list-group list-group-flush exp_card_item_size ">
                            <li class="list-group-item exp_item_padding">2016-11-08 23:32:06</li>
                            <li class="list-group-item exp_item_padding">com.hgt.App 163</li>
                        </ul>
                        <div class="card-block exp_contents_padding ">
                            <div class="_float_left">
                                <a href="#" class="card-link exp_card_text_size">查看详情</a>

                            </div>
                            <div class="_float_right">
                                <span class="label label-danger label-pill float-xs-right exp_card_item_size">严重</span>

                            </div>

                            <!--<span class="_text_align_right ">严重</span>-->
                        </div>
                    </div>
                </div>

            </div>

        </div>

        <div class="col-sm-1  _text_align_center _to_top30 ">
            <i class="fa  fa-angle-right fa-4x  c_bdbdbd"></i>
        </div>
    </div>
</div>
<!--/异常监控模块-->


<!--日志统计模块-->
<div id="logsStats" class="container-fluid  screen-page bg_white_pure _text_align_center">
    <a name="aLogsStats"></a>
    <div class="row blank_divider30"></div>
    <h2>日志统计</h2>
    <div>
        <svg id="svgLogsForce" width="1080" height="512"></svg>
    </div>
</div>
<!--/日志统计模块-->

<!--用户挖掘模块-->
<div id="logsBehavior" class="container-fluid screen-page bg_gray_shallow">
    <a name="aLogsBehavior"></a>
    <div class="row blank_divider30"></div>
    <div class="row _height100">

        <!--访问排行榜-->
        <div class="col-sm-3 _text_align_center ">

            <div class="card text-xs-center ">
                <div class="card-header">
                    <ul class="nav nav-pills card-header-pills float-xs-left">
                        <li class="nav-item">
                            <a class="nav-link active" href="javascript:void(0)">IP访问排行</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="javascript:void(0)">搜索排行</a>
                        </li>

                    </ul>
                </div>
                <div class="card-block bg_f5f5f5 ">
                    <ul class="list-group list-group-flush _no_border  _text_align_left bg_f5f5f5 ">
                        <li class="list-group-item _no_border search_top_padding bg_f5f5f5 ">Cras justo odio</li>
                        <li class="list-group-item _no_border search_top_padding bg_f5f5f5">Dapibus ac facilisis in</li>
                        <li class="list-group-item _no_border search_top_padding bg_f5f5f5">Vestibulum at eros</li>
                        <li class="list-group-item _no_border search_top_padding bg_f5f5f5">Cras justo odio</li>
                        <li class="list-group-item _no_border search_top_padding bg_f5f5f5">Dapibus ac facilisis in</li>
                        <li class="list-group-item _no_border search_top_padding bg_f5f5f5">Vestibulum at eros</li>
                        <li class="list-group-item _no_border search_top_padding bg_f5f5f5">Cras justo odio</li>
                        <li class="list-group-item _no_border search_top_padding bg_f5f5f5">Dapibus ac facilisis in</li>
                        <li class="list-group-item _no_border search_top_padding bg_f5f5f5">Vestibulum at eros</li>
                        <li class="list-group-item _no_border search_top_padding bg_f5f5f5">Vestibulum at eros</li>
                    </ul>
                    <div class="card-block _text_align_left search_top_padding">
                        <i class="fa fa-angle-double-down fa-2x c_999 "></i>
                    </div>

                </div>
            </div>
        </div>
        <!--/访问排行榜-->

        <div class="co-sm-9 _text_align_center ">
            <!--<h2>IP访客分布图</h2>-->
            <div id="map" class=""></div>
        </div>
    </div>

    <!--访客IP分布图-->

</div>

</div>
<!--/用户挖掘模块-->

<!--末尾页脚-->

<div id="lastFooter" class="container-fluid blank_divider160 bg_gray_barely">
    <a name="about"></a>
    <div class="row blank_divider20"></div>
    <div class="row _text_align_center">
        <div class="col-sm-12">
            <div class="h5">联系我们</div>
        </div>
    </div>
    <div class="row blank_divider10"></div>

    <div class="row">
        <div class="col-sm-6 _text_align_right">
            <i class="fa fa-home"></i>
        </div>
        <div class="col-sm-6 _text_align_left">
            <span style="padding-left: 15px">湖北武汉</span>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-6 _text_align_right">
            <i class="fa fa-phone"></i></div>
        <div class="col-sm-6 _text_align_left">
            <span style="padding-left: 15px">17086542389</span></div>
    </div>
    <div class="row">
        <div class="col-sm-6 _text_align_right">
            <i class="fa fa-envelope"></i></div>
        <div class="col-sm-6 _text_align_left">
            <span style="padding-left: 15px">helloworld@qq.com</span></div>
    </div>
</div>
<!--/末尾页脚-->

<!-- jQuery first, optional tether for tooltips, then Bootstrap JS. -->
<script type="text/javascript" src="../res/scripts/js/jquery-3.1.0.js"></script>
<script type="text/javascript" src="../res/scripts/js/tether-1.3.2.min.js"></script>
<!--<script type="text/javascript" src="../res/scripts/js/bootstrap-4.0.0a3.js"></script>-->
<script type="text/javascript" src="../res/scripts/js/bootstrap-3.3.7.js"></script>
<script type="text/javascript" src="../res/scripts/js/holder-2.6.0.min.js"></script>
<script type="text/javascript" src="../res/scripts/js/d3-3.5.17.js"></script>
<script type="text/javascript" src="../res/scripts/js/leaflet-1.0.0rc3.js"></script>
<!--<script type="text/javascript" src="../res/scripts/svg.js"></script>-->
<!--<script type="text/javascript" src="../res/scripts/scripts.js"></script>-->
<script type="text/javascript" src="../res/scripts/utils.js"></script>
<!--<script type="text/javascript" src="../res/scripts/ipviews.js"></script>-->
<script src='https://api.tiles.mapbox.com/mapbox.js/v1.6.4/mapbox.js'></script>


<script type="text/javascript">

    <!--
    IP地址浏览-->
    var apps = apps || {};
    apps.namespace = function (str) {
        var parts = str.split("."),
                parent = apps,
                i = 0,
                l = 0;

        if (parts[0] === "apps") {
            parts = parts.slice(1);
        }

        for (i = 0, l = parts.length; i < l; i++) {
            if (typeof parent[parts[i]] === "undefined") {
                parent[parts[i]] = {};
            }
            parent = parent[parts[i]];
        }
        return parent;
    }

    apps.attrs = {
        "mapSources": [
            {
                "mapbox": "//{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png"
            },
            {
                "autonavi": "//webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}"
            },
            {
                "osm": "//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
            }
        ]
    };

    apps.data = {
        "hgtPoint": {
            "type": "FeatureCollection",
            "crs": {
                "type": "name",
                "properties": {
                    "name": "urn:ogc:def:crs:OGC:1.3:CRS84"
                }
            },
            "features": [
                {
                    "type": "Feature",
                    "properties": {
                        "time": 16,
                        "id": "route1",
                        "name": "lhkServerPoint"
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [
                            114.400,
                            30.503
                        ]
                    }
                }
            ]
        },

        "ipPoints1": {
            "type": "FeatureCollection",
            "crs": {
                "type": "name",
                "properties": {
                    "name": "urn:ogc:def:crs:OGC:1.3:CRS84"
                }
            },
            "features": [
                {
                    "type": "Feature",
                    "properties": {
                        "time": 1,
                        "id": "route1",
                        "name": "p1"
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [
                            114.360477,
                            30.527036
                        ]
                    }
                },
                {
                    "type": "Feature",
                    "properties": {

                        "time": 16,
                        "id": "route1",
                        "name": "p2"
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [
                            114.420,
                            30.520
                        ]
                    }
                }
            ]
        }
    };

    apps.maps = {
        mapOperations: (function () {
            return {
                initBasemap: function (mapUrl) {
                    return L.tileLayer(mapUrl);
                }

            }
        })(),
        animations: {
            arcInterpolate: function (points) {
                return points.join("A 30,30 0 0 1 ");
            }

        },
        general: {
            projectPoint: function (x, y) {
                var point = apps.attrs.map.latLngToLayerPoint(new L.LatLng(y, x));
                this.stream.point(point.x, point.y);
            },
            applyLatLngToLayer: function (d) {
                //获取纬度
                var y = d.geometry.coordinates[1];
                //获取经度
                var x = d.geometry.coordinates[0];
                //LatLngToLayerPoint is used to get coordinates for the layer's new position
                return apps.attrs.map.latLngToLayerPoint(new L.LatLng(y, x));
            }
        }
    };

    apps.start = {
        init: function () {
            var mData = apps.namespace("apps.data");


            var mapTiles = L.tileLayer(apps.attrs.mapSources[0].mapbox);
            apps.attrs.map = L.map('map').addLayer(mapTiles).setView([30.520, 114.360], 10);
            var map = apps.namespace("apps.attrs.map");
            apps.attrs.svg = d3.select(map.getPanes().overlayPane).append("svg");
            apps.attrs.g = apps.attrs.svg.append("g").attr("class", "leaflet-zoom-hide");

        },
        go: function () {
            var mData = apps.namespace("apps.data");
            var mMaps = apps.namespace("apps.maps");

            var mMapOperations = apps.namespace("apps.maps.mapOperations");
            var map = apps.namespace("apps.attrs.map");
            var svg = apps.namespace("apps.attrs.svg");
            var g = apps.namespace("apps.attrs.g");

            var lhkServerPoint = mData.hgtPoint;
            var ipPoints = mData.ipPoints1;

//            console.log(lhkServerPoint)
//            console.log(ipPoints)


            //把导入的各个坐标点作为起点，把服务器位置作为终点，构建起止点数组
            var startEndArr = [];
            var pLength = ipPoints.features.length;
            for (var i = 0; i < pLength; i++) {
                var tempLine = cloneObj(lhkServerPoint);
                var x1 = lhkServerPoint.features[0];
                tempLine.features[0] = ipPoints.features[i];
                tempLine.features[1] = x1;
                startEndArr[i] = tempLine;
            }
//            console.log(startEndArr);

            //定义方法：将经纬度转成屏幕地图图层点
            var transform = d3.geo.transform({
                point: apps.maps.general.projectPoint
            });
            var d3path = d3.geo.path().projection(transform);


            var collection = startEndArr[0];
            var featuresdata = collection.features;


            var toLine = d3.svg.line()
                    .interpolate(function (points) {
                        return points.join("A 30,30 0 0 1 ");
                    })
                    .x(function (d) {
                        return mMaps.general.applyLatLngToLayer(d).x;
                    })
                    .y(function (d) {
                        return mMaps.general.applyLatLngToLayer(d).y;
                    });


//            目标服务器点，用于reset刷新
            var ptFeatures = g.selectAll("circle")
                    .data(lhkServerPoint.features)
                    .enter()
                    .append("circle")
                    .attr("r", 3)
                    .attr("class", "travelMarker");


            //声明每对起止点的线
//            for (var ii = 0; ii < pLength; ii++) {
//
//
//
//            }

            var lines = cloneObj([featuresdata]);
            lines[1] = cloneObj(featuresdata);

            lines[1][0].geometry.coordinates[0] = 114.43;

//            console.log(lines);

            //已走路线
            var linePath = g.selectAll(".lineConnect")
                    .data(lines)
                    .enter()
                    .append("path")
                    .attr("class", "lineConnect");


            // 运动点
//            var marker = g.append("circle")
//                    .attr("r", 10)
//                    .attr("id", "marker")
//                    .attr("class", "travelMarker");

            // NOT BEST Practice. Style start & end points.
//            var originANDdestination = [featuresdata[0], featuresdata[1]]

            map.on("viewreset", reset);

            // this puts stuff on the map!
            reset();

            // Reposition the SVG to cover the features. 注意裁剪
            function reset() {
                var bounds = d3path.bounds(ipPoints),
                        topLeft = bounds[0],
                        bottomRight = bounds[1];


                ptFeatures.attr("transform",
                        function (d) {
                            return "translate(" +
                                    mMaps.general.applyLatLngToLayer(d).x + "," +
                                    mMaps.general.applyLatLngToLayer(d).y + ")";
                        });


                // Setting the size and location of the overall SVG container
                svg.attr("width", bottomRight[0] - topLeft[0] + 100)
                        .attr("height", bottomRight[1] - topLeft[1] + 100)
                        .style("left", topLeft[0] - 50 + "px")
                        .style("top", topLeft[1] - 50 + "px");


                linePath.attr("d", toLine);

                var totalLength = linePath.node().getTotalLength();

                linePath.attr("stroke-dasharray", totalLength + "," + totalLength)
                        .attr("stroke-dashoffset", totalLength)
                        .transition()
                        .duration(300)
                        .ease("linear")
                        .attr("stroke-dashoffset", 0)
                ;

                g.attr("transform", "translate(" + (-topLeft[0] + 50) + "," + (-topLeft[1] + 50) + ")");
            } // end reset

        }


//        }
    }

    apps.start.init();
    apps.start.go();
    <!--/IP地址浏览-->
</script>
</body>
</html>